<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="Communicate intent and decisions via software design">
<title>Software design with lambda expressions</title>

<link rel='canonical' href='//localhost:1313/software-design-with-lambda-expressions/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="Software design with lambda expressions">
<meta property='og:description' content="Communicate intent and decisions via software design">
<meta property='og:url' content='//localhost:1313/software-design-with-lambda-expressions/'>
<meta property='og:site_name' content='Nikos Voulgaris'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='software design' /><meta property='article:tag' content='functional programming' /><meta property='article:published_time' content='2019-09-01T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2019-09-01T00:00:00&#43;00:00'/><meta property='og:image' content='//localhost:1313/img/posts/software_design_with_lambda_expressions.jpg' />
<meta name="twitter:title" content="Software design with lambda expressions">
<meta name="twitter:description" content="Communicate intent and decisions via software design"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='//localhost:1313/img/posts/software_design_with_lambda_expressions.jpg' />
    <link rel="shortcut icon" href="/favicon.ico" />

      <script async src="https://www.googletagmanager.com/gtag/js?id=G-7643KK7Q6D"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-7643KK7Q6D');
        }
      </script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    <img src="../../img/nv_author_icon.jpg" width="300" height="300" class="site-logo" loading="lazy" alt="Avatar">
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="//localhost:1313/">Nikos Voulgaris</a></h1>
            <h2 class="site-description">Challenge everything</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/nvoulgaris'
                        target="_blank"
                        title="Github"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/nivoul'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.linkedin.com/in/nikos-voulgaris-44455546'
                        target="_blank"
                        title="LinkedIn"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About Me</span>
            </a>
        </li>
        
        
        <li >
            <a href='/tags' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11 3L20 12a1.5 1.5 0 0 1 0 2L14 20a1.5 1.5 0 0 1 -2 0L3 11v-4a4 4 0 0 1 4 -4h4" />
  <circle cx="9" cy="9" r="2" />
</svg>



                
                <span>Tags</span>
            </a>
        </li>
        
        
        <li >
            <a href='/books' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Books</span>
            </a>
        </li>
        
        
        <li >
            <a href='/contact' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-messages" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M21 14l-3 -3h-7a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1h9a1 1 0 0 1 1 1v10" />
  <path d="M14 15v2a1 1 0 0 1 -1 1h-7l-3 3v-10a1 1 0 0 1 1 -1h2" />
</svg>



                
                <span>Contact</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                <form action="/search/" class="search-form widget" >
        <p>
            <label>Search</label>
            <input name="keyword" required placeholder="Type something..." />
        
            <button title="Search">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



            </button>
        </p>
    </form>
            
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#the-case-study">The case study</a>
      <ul>
        <li><a href="#room-for-improvement">Room for improvement</a></li>
      </ul>
    </li>
    <li><a href="#the-loan-pattern">The loan pattern</a></li>
    <li><a href="#applying-the-loan-pattern">Applying the loan pattern</a></li>
    <li><a href="#retrospective">Retrospective</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
        </div>
    </section>

            
        
            
                <section class="widget tagCloud">
    <div class="widget-icon">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11 3L20 12a1.5 1.5 0 0 1 0 2L14 20a1.5 1.5 0 0 1 -2 0L3 11v-4a4 4 0 0 1 4 -4h4" />
  <circle cx="9" cy="9" r="2" />
</svg>



    </div>
    <h2 class="widget-title section-title">Tags</h2>

    <div class="tagCloud-tags">
        
            <a href="/tags/agile/" class="font_size_9">
                Agile
            </a>
        
            <a href="/tags/software-design/" class="font_size_5">
                Software Design
            </a>
        
            <a href="/tags/scrum/" class="font_size_4">
                Scrum
            </a>
        
            <a href="/tags/unit-testing/" class="font_size_3">
                Unit-Testing
            </a>
        
            <a href="/tags/xp/" class="font_size_3">
                XP
            </a>
        
            <a href="/tags/graphql/" class="font_size_2">
                GraphQL
            </a>
        
            <a href="/tags/retrospectives/" class="font_size_2">
                Retrospectives
            </a>
        
            <a href="/tags/code-coverage/" class="font_size_1">
                Code-Coverage
            </a>
        
            <a href="/tags/encapsulation/" class="font_size_1">
                Encapsulation
            </a>
        
            <a href="/tags/functional-programming/" class="font_size_1">
                Functional Programming
            </a>
        
    </div>
</section>
            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/software-design-with-lambda-expressions/">
                
                    <img src="/img/posts/software_design_with_lambda_expressions.jpg" loading="lazy" alt="Featured image of post Software design with lambda expressions" />
                
            </a>
        </div>
    

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/software-design-with-lambda-expressions/">Software design with lambda expressions</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            Communicate intent and decisions via software design
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Sep 01, 2019</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    9 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>Lambda expressions are powerful and allow us to write concise, elegant, declarative code. A lot of people has already adopted them, mainly leveraging the power of streams in iterations, but lambda&rsquo;s toolkit is far richer than that. This is why I decided to write this blog post and explore some aspects of how lambda expressions can prove useful in software design.</p>
<p>We will do this exploration via a real world case study in order to demonstrate how we can apply these principles in our everyday work.</p>
<h2 id="the-case-study">The case study
</h2><p>Instead of creating a new case study, from scratch, I decided to extend the one from my previous blog <a class="link" href="https://nvoulgaris.com/open-closed-principle-a-case-study"  target="_blank" rel="noopener"
    >post</a>, in which we examined closely the problem of input validation. We assumed an android application that displays a form and we came up with a robust solution to validate the input of this form (leaving out android specifics on purpose and simplifying a bit to put emphasis on the right parts).</p>
<p>The key takeaway was that after drafting a first, working version of the code, we refactored our way to a much better crafted one. We applied the Open-Closed Principle so that we could extend the behavior of our validation module (e.g. add validation for new fields, such as a postcode field) without having to modify our existing validation code. In this way, we improved the design of our solution by making the code <em>less fragile</em> and therefore <em>more maintainable</em>.</p>
<h3 id="room-for-improvement">Room for improvement
</h3><p>However, in software, there is no such thing as a <em>perfect</em> design and there never will be. There will always be things to improve. As responsible, professional software craftspeople, we should always study the pros and cons of our solutions and know their weaknesses and limitations and, as I always like to say, <em>work the trade-offs</em>.</p>
<p>Considering the solution of the previous post, there is definitely room for improvement. First of all, as already mentioned in that post, we should apply the Dependency Inversion Principle to invert the dependencies between the <code>ValidationService</code> and <code>EmailValidator</code> and <code>PhoneValidator</code> (currently there is a transitive dependency between them, while the former should not know about the latter). A second point of interest is the life cycle of the <code>ViewValidator</code> object that we create. Please remember that we designed it to be used like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>formViews.<span style="color:#a6e22e">forEach</span>(view <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>    ViewValidator validator <span style="color:#f92672">=</span> ViewValidatorFactory.<span style="color:#a6e22e">makeFor</span>(view);
</span></span><span style="display:flex;"><span>    validator.<span style="color:#a6e22e">validate</span>(view.<span style="color:#a6e22e">getText</span>());
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p><em>Allow me to refresh our memory on a few basic points for this case study. We assumed that we have a list of <code>View</code> objects (in android all UI elements derive from <code>View</code>) and that all these objects have a tag, which we can retrieve using a <code>getter</code>, denoting the viewâ€™s input type (e.g. <code>Email</code> or <code>Phone</code>) and a <code>getter</code> to retrieve the text of the view.</em></p>
<p>In this case we create a new instance of <code>ViewValidator</code> for every view that we wish to validate. However, this does not come naturally from the design of the class. <em>We do not know it</em>. We simply <em>assumed</em> it. And these kind of assumptions can lead to a great deal of problems down the road. What if we have a bunch of similar views to validate (e.g. 3 e-mail fields)? Should we use the same instance for all 3 of them or is this instance disposable and we should create a fresh one for each validation? Well, the answer is that there is no way to know (unless, of course, we open the <code>ViewValidator</code> source code and have a look ourselves). <em>The design of the class does not communicate its intent</em> as far as the life cycle of the object is concerned.</p>
<p>This is clearly an issue that could - and perhaps should - be addressed. Thinking carefully about the architecture of the system (its design on a macro level) is essential, but taking the time to think through our micro level design (e.g. class design) is equally important.</p>
<h2 id="the-loan-pattern">The loan pattern
</h2><p>Thankfully, there is a design pattern, which solves exactly this problem, in a <em>very elegant way</em> and its name is the <strong>loan pattern</strong>. I first came across it while reading Venkat Subramaniam&rsquo;s excellent book <a class="link" href="https://www.goodreads.com/book/show/17698629-functional-programming-in-java"  target="_blank" rel="noopener"
    >Functional Programming in Java</a>. Venkat does a wonderful job explaining this pattern as it naturally emerges while refactoring a real world piece of code and I suggest that you read it (see section <em>&ldquo;Creating Fluent Interfaces Using Lambda Expressions&rdquo;</em>), but I will try to explain the basic points myself here.</p>
<p>Essentially, the pattern removes the responsibility of dealing with the object&rsquo;s life cycle from the function that uses it. Instead, this responsibility lies with the class itself. In order to achieve this, we <em>create</em> a resource and <em>pass</em> it to the function. As soon as the function terminates, the resource is <em>destroyed</em>.</p>
<p>In our case, to achieve this, we would ideally want to write something like this (remember that <code>tags</code> is what will be used to determine the type of validation that should be applied and <code>value</code> is the value that is to be validated)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Validator.<span style="color:#a6e22e">validate</span>(
</span></span><span style="display:flex;"><span>  validator <span style="color:#f92672">-&gt;</span> validator.<span style="color:#a6e22e">withTags</span>(<span style="color:#e6db74">&#34;email&#34;</span>).<span style="color:#a6e22e">withValue</span>(<span style="color:#e6db74">&#34;someone@example.com&#34;</span>)
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>The point is that whoever uses this piece of code does not have to worry about the life cycle of the <code>Validator</code> object. An instance will be passed as an argument and destroyed as soon as the <code>validate()</code> function terminates. This is where the name comes from. The <code>Validator</code> object is <em>loaned</em> to the function.</p>
<p>This is an incredibly <em>smart</em> and <em>elegant</em> solution to a very sneaky problem. Lambda expressions empower us to implement it. Let&rsquo;s dive into the implementation.</p>
<h2 id="applying-the-loan-pattern">Applying the loan pattern
</h2><p>Assuming that the <code>Validator</code> class is to be used as stated above, the obvious challenge would be to come up with a way to make use of the loaned resource in the <code>validate()</code> function. This can be easily achieved with the <code>Consumer</code> functional interface (<code>java.util.function.Consumer</code>), which is designed to accept an object and execute a piece of code on it. So, redesigning our <code>Validator</code> class like the following, would do the job.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Validator</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> String COMMA <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;,&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String tags;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String value;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">Validator</span>() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Validator <span style="color:#a6e22e">withTags</span>(<span style="color:#66d9ef">final</span> String tags) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">tags</span> <span style="color:#f92672">=</span> tags;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Validator <span style="color:#a6e22e">withValue</span>(<span style="color:#66d9ef">final</span> String value) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> value;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> List<span style="color:#f92672">&lt;</span>Violation<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">validate</span>(<span style="color:#66d9ef">final</span> Consumer<span style="color:#f92672">&lt;</span>Validator<span style="color:#f92672">&gt;</span> block) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">final</span> Validator validator <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Validator();
</span></span><span style="display:flex;"><span>        block.<span style="color:#a6e22e">accept</span>(validator);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> validator.<span style="color:#a6e22e">applyValidations</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>Violation<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">applyValidations</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Arrays.<span style="color:#a6e22e">stream</span>(tags.<span style="color:#a6e22e">split</span>(COMMA))
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">map</span>(<span style="color:#66d9ef">this</span>::validationFor)
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">map</span>(validation <span style="color:#f92672">-&gt;</span> validation.<span style="color:#a6e22e">applyTo</span>(value))
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">flatMap</span>(List::stream)
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">collect</span>(Collectors.<span style="color:#a6e22e">toList</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Validation <span style="color:#a6e22e">validationFor</span>(<span style="color:#66d9ef">final</span> String tag) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">switch</span> (tag) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;Email&#34;</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> EmailValidation();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;Phone&#34;</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> PhoneValidation();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">default</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> DefaultValidation();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>There&rsquo;s a lot of things to notice in this class, so let&rsquo;s take them one by one.</p>
<ul>
<li>
<p>First, the <code>validate()</code> function, does exactly what we discussed earlier. It accepts a piece of code meant to be executed in an instance of <code>Validator</code>. It creates this instance and executes this piece of code on it. This serves in &ldquo;configuring&rdquo; the object with the right tags and value. Then, it applies the appropriate validations. Notice that we also made the constructor private, essentially <em>disallowing direct instantiation</em> and explicitly <em>removing the burden of this responsibility from the caller</em>. We make sure that no one will instantiate this class (other than the <code>validate()</code> function of course). The <code>withTags()</code> and <code>withValue()</code> functions act as builder functions that allow us to chain our calls.</p>
</li>
<li>
<p>Secondly, instead of an explicit factory class to create specific <code>Validation</code> objects based on the tags, we achieve this in the <code>validationFor()</code> factory method. This has the extra benefit of encapsulating the <code>Validation</code> polymorphic instantiation logic in the <code>Validator</code> class, which is the only one that needs to know about it anyway. The various <code>Validation</code> derivatives (<code>EmailValidation</code>, <code>PhoneValidation</code> etc) are implementation details and are subject to change at any time. No one should depend on them.</p>
</li>
<li>
<p>Finally, the <code>applyValidations()</code> function pretty much does what the client in the previous version was doing. It splits the tags of the view and creates an appropriate <code>Validation</code> for each tag. Then it applies this validation to the value and finally, it flattens all the violations in a single list to return it. Usage of lambda expressions makes this function declarative, elegant and very readable.</p>
</li>
</ul>
<p>Below is the <code>Validation</code> interface</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Validation</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    List<span style="color:#f92672">&lt;</span>Violation<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">applyTo</span>(<span style="color:#66d9ef">final</span> String value);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>and its three derivatives</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EmailValidation</span> <span style="color:#66d9ef">implements</span> Validation {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>Violation<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">applyTo</span>(<span style="color:#66d9ef">final</span> String value) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Actual email validation code omitted for brevity</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Arrays.<span style="color:#a6e22e">asList</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PhoneValidation</span> <span style="color:#66d9ef">implements</span> Validation {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>Violation<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">applyTo</span>(<span style="color:#66d9ef">final</span> String value) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Actual phone validation code omitted for brevity</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Arrays.<span style="color:#a6e22e">asList</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DefaultValidation</span> <span style="color:#66d9ef">implements</span> Validation {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>Violation<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">applyTo</span>(<span style="color:#66d9ef">final</span> String value) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Arrays.<span style="color:#a6e22e">asList</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>That&rsquo;s it. We have implemented the loan pattern.</p>
<h2 id="retrospective">Retrospective
</h2><p>So, by this point you might be wondering if it is worthwhile to go through all this refactoring. Let&rsquo;s take a step back and examine what we have achieved.</p>
<ul>
<li>
<p>First of all, the we still comply to the Open-Closed principle and therefore <em>we can extend the module&rsquo;s behavior without modifying existing code</em>.</p>
</li>
<li>
<p>Additionally, the <em>responsibility of the life cycle</em> of the <code>Validator</code> object <em>does not lie with the caller</em>, but we have already taken care of it.</p>
</li>
<li>
<p>Furthermore, what&rsquo;s really important - and unfortunately seriously underestimated - is that <em>the design communicates this decision</em>.</p>
</li>
<li>
<p>Finally, an additional advantage is that <code>Validation</code> instantiation logic is <em>encapsulated</em> in the <code>Validator</code> class, along with the rest of its implementation details.</p>
</li>
</ul>
<p>As far as the form validation case study is concerned, it might worth it or it might not. To be honest, it doesn&rsquo;t matter. I did take the trouble to do exactly this refactor (except in Kotlin) the first time that I had to enhance our validation feature after having read Venkat&rsquo;s book, but that is up to each one of us. Once again, as software craftspeople it&rsquo;s us that should work the trade-offs everyday and make the call. In any case, the key point is that <em>we can use functional interfaces and lambda expressions to produce elegant and robust software designs</em>.</p>
<h2 id="conclusion">Conclusion
</h2><p>Lambda expressions allow us to write concise and declarative code, but they offer way more than that. They can be used as a <em>design tool</em>. High order functions (functions that take functions as arguments) are a game changer and they can fundamentally alter our perceptions on architecture, design patterns and software design.</p>
<p>Refactoring to transfer the responsibility of managing a resource&rsquo; s life cycle from the caller to the callee may be worthwhile or not, depending on the problem in hand. It is important knowing that we have the option and being able to make a call on a per case basis.</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/software-design/">Software Design</a>
        
            <a href="/tags/functional-programming/">Functional Programming</a>
        
    </section>


    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/open-closed-principle-a-case-study/">
        
        
            <div class="article-image">
                
                    <img src="/img/posts/open_closed.jpg" loading="lazy" data-key="" data-hash="/img/posts/open_closed.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Open-Closed principle: a case study</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/how-getters-and-setters-harm-encapsulation/">
        
        
            <div class="article-image">
                
                    <img src="/img/posts/encapsulation.jpg" loading="lazy" data-key="" data-hash="/img/posts/encapsulation.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">How getters and setters harm encapsulation</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/test-behavior/">
        
        
            <div class="article-image">
                
                    <img src="/img/posts/writing.jpg" loading="lazy" data-key="" data-hash="/img/posts/writing.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Test behavior</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/designing-a-restful-shopping-cart/">
        
        
            <div class="article-image">
                
                    <img src="/img/posts/shopping_cart.jpg" loading="lazy" data-key="" data-hash="/img/posts/shopping_cart.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Designing a RESTful shopping cart</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div id="disqus_thread"></div>
<script>





(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://nvoulgaris-com.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2018 - 
        
        2025 Nikos Voulgaris
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.f2f884c56e88ca44e1beaddd6848213310859cf04e903e60380da4faa2dcb8c8.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
